# 快速开始指南

## 一、系统要求

### 必需环境
- **Python**: 3.11 或更高版本
- **PostgreSQL**: 12 或更高版本
- **LLM API Key（任选其一）**: 系统支持 **OpenAI、DeepSeek、Claude、Qianwen（通义千问）**，在 `.env` 中配置任意一家密钥即可；嵌入支持 OpenAI 或 Qianwen

### 可选环境
- **Jaeger**: 分布式追踪（可选）
- **Elasticsearch**: 全文检索增强（可选）

## 二、安装步骤

### 1. 克隆或下载项目
```bash
cd "F:\Intent-Driven Retrieval & Workflow Decision System"
```

### 2. 创建虚拟环境（推荐）
```bash
# Windows (Python 3.13)
py -3.13 -m venv .venv
.venv\Scripts\activate

# Windows (其他版本)
python -m venv .venv
.venv\Scripts\activate

# Linux/Mac
python3 -m venv .venv
source .venv/bin/activate
```

### 3. 升级 pip 和工具
```bash
python -m pip install --upgrade pip setuptools wheel
```

### 4. 安装依赖
```bash
# 推荐使用 python -m pip（特别是 Python 3.13）
python -m pip install -r requirements.txt
```

**注意**: 如果遇到依赖冲突（特别是 OpenTelemetry 相关），请参考 [Python 3.13 兼容性说明](06_Python313兼容性说明.md)

### 5. 创建 PostgreSQL 数据库
```bash
# 方式一：使用 psql
psql -U postgres
CREATE DATABASE intent_system;
\q

# 方式二：使用 createdb
createdb -U postgres intent_system
```

### 6. 配置环境变量
复制 `.env.example` 为 `.env`：
```bash
cp .env.example .env
```

编辑 `.env` 文件，配置以下内容：
```env
# 数据库配置（必须）
DATABASE_URL=postgresql://postgres:你的密码@localhost:5432/intent_system

# LLM API Key（必须，任选一家即可，优先使用 .env 中配置的密钥）
# 使用 OpenAI
OPENAI_API_KEY=sk-your-api-key-here
# 或使用 DeepSeek：DEEPSEEK_API_KEY=sk-...
# 或使用 Claude：ANTHROPIC_API_KEY=sk-ant-...
# 或使用通义千问：DASHSCOPE_API_KEY=sk-...
# 可选：指定提供商 LLM_PROVIDER=openai|deepseek|claude|qianwen

# 向量存储路径（可选，默认 ./data/chroma）
VECTOR_STORE_PATH=./data/chroma

# 数据库日志（可选，调试时设为 true）
DB_ECHO=false

# Jaeger 配置（可选）
JAEGER_ENABLED=false
JAEGER_HOST=localhost
JAEGER_PORT=6831
```

多 LLM 提供商详细配置见 [LLM 多提供商配置](07_LLM多提供商配置.md)。

### 7. 初始化数据库表结构
```bash
alembic upgrade head
```

### 8. 初始化 C 语言知识库（可选但推荐）
```bash
python scripts/init_c_language_kb.py
```

### 9. 启动服务
```bash
python run.py
```

服务将在 `http://localhost:8000` 启动。

## 三、验证安装

### 1. 健康检查
```bash
curl http://localhost:8000/v1/health
```

预期返回：
```json
{"status": "ok"}
```

### 2. 查看 API 文档与测试界面
- **服务测试界面**（左栏使用说明、右栏白板式测试各 API）：http://localhost:8000/ui
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

### 3. 测试聊天接口
```bash
curl -X POST http://localhost:8000/v1/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "如何修改 C 语言中的数组元素？",
    "context": {"tenant_id": "default"},
    "options": {"output_format": "steps"}
  }'
```

## 四、常见问题

### 问题 1: 数据库连接失败
**错误**: `could not connect to server`
**解决**:
1. 确认 PostgreSQL 服务已启动
2. 检查 `DATABASE_URL` 配置是否正确
3. 确认数据库 `intent_system` 已创建

### 问题 2: LLM API 错误（OpenAI / DeepSeek / Claude / Qianwen）
**错误**: `Invalid API key` 或调用失败
**解决**:
1. 检查 `.env` 中当前使用的提供商及对应 Key（`OPENAI_API_KEY` / `DEEPSEEK_API_KEY` / `ANTHROPIC_API_KEY` / `DASHSCOPE_API_KEY`）
2. 确认 `LLM_PROVIDER` 与所填 Key 一致（或留空由系统自动推断）
3. 确认 API Key 有效且有余额
4. 使用 Claude 时需安装：`pip install anthropic`
5. 详见 [LLM 多提供商配置](07_LLM多提供商配置.md) 与 [故障排查 - LLM API](05_故障排查.md#三llm-api-问题)

### 问题 3: 端口被占用
**错误**: `Address already in use`
**解决**:
1. 修改 `run.py` 中的端口号
2. 或使用参数: `uvicorn services.chat_api.main:app --port 8001`

### 问题 4: 迁移失败
**错误**: `relation already exists`
**解决**:
1. 检查表是否已存在
2. 开发环境可删除表后重新迁移
3. 生产环境需要手动处理冲突

## 五、下一步

安装成功后，请继续阅读：
- [配置指南](02_配置指南.md)
- [LLM 多提供商配置](07_LLM多提供商配置.md)（切换 OpenAI / DeepSeek / Claude / Qianwen）
- [使用说明](03_使用说明.md)
- [维护指南](04_维护指南.md)
